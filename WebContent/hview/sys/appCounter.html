<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>列表</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="../../plugin/layui-v2.3.0-rc1/layui/css/layui.css" media="all">
		<link rel="stylesheet" href="js/layer.css" media="all">
		<!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
		<script src="../../plugin/layui-v2.3.0-rc1/layui/layui.js"></script>
		<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
		<script src="../../plugin/jquery-1.12.4.min.js"></script>
		<script src="js/echarts.common.min.js"></script>
		<script src="js/layer.js"></script>
	</head>
	<body>
		<button id="test2">查看统计折线图</button>
		<div id="speedChart" style="display: none;">
			<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
			<div id="speedChartMain" style="width: 1600px; height: 800px;"></div>
		</div>
	</body>
	<script type="text/javascript">
		var time = [];
		var loginNum = [];
		var loginCount = [];
		var userOnlineCount = [];
		/*$(function() {
			$.ajax({
				url: "/piPaiCampus/rest/appMgr/queryAppCounter",
				type: 'POST',
				success: function(result) {
					console.log(result);
					var data = result.data;
					for(var i = 0; i < data.length; i++) {
						time.push(data[i].startTime);
						loginNum.push(data[i].loginNum);
						loginCount.push(data[i].loginCount);
						userOnlineCount.push(data[i].userOnlineCount);

					}
				}
			});
		});*/

		function timestampToTime(inputTime) {
			var date = new Date(inputTime);
			var y = date.getFullYear();
			var m = date.getMonth() + 1;
			m = m < 10 ? ('0' + m) : m;
			var d = date.getDate();
			d = d < 10 ? ('0' + d) : d;
			var h = date.getHours();
			h = h < 10 ? ('0' + h) : h;
			var minute = date.getMinutes();
			var second = date.getSeconds();
			minute = minute < 10 ? ('0' + minute) : minute;
			second = second < 10 ? ('0' + second) : second;
			return y + '-' + m + '-' + d + ' ' + h + ':' + minute + ':' + second;
		}

		window.onload = function() {
			$.ajax({
				url: "/piPaiCampus/rest/appMgr/queryAppCounter",
				type: 'POST',
				success: function(result) {
					console.log(result);
					var data = result.data;
					for(var i = 0; i < data.length; i++) {
						time.push(timestampToTime(data[i].startTime) + "-" + timestampToTime(data[i].endTime));
						loginNum.push(data[i].loginNum);
						loginCount.push(data[i].loginCount);
						userOnlineCount.push(data[i].userOnlineCount);

					}
					var myChart = echarts.init(document.getElementById('speedChartMain'));
					option = {
						tooltip: {
							trigger: 'axis'
						},
						legend: {
							data: ['登录人数', '登录人次', '在线人数']
						},
						grid: {
							left: '3%',
							right: '4%',
							bottom: '3%',
							containLabel: true
						},
						toolbox: {
							feature: {
								saveAsImage: {}
							}
						},
						xAxis: {
							type: 'category',
							boundaryGap: false,
							data: time
						},
						yAxis: {

							type: 'value'
						},
						series: [{
								name: '登录人数',
								type: 'line',
								stack: '总量',
								data: loginNum
							},
							{
								name: '登录人次',
								type: 'line',
								stack: '总量',
								data: loginCount
							},
							{
								name: '在线人数',
								type: 'line',
								stack: '总量',
								data: userOnlineCount
							}
						]
					};
					myChart.setOption(option);
				}
			});
		}
		//弹出一个页面层
		$('#test2').on('click', function() {
			layer.open({
				title: 'App信息统计',
				type: 1,
				shade: false,
				area: ['1600px', '800px'],
				shadeClose: false, //点击遮罩关闭
				content: $("#speedChart")
			});
		});
	</script>

</html>